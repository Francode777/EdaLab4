import java.text.SimpleDateFormat;
import java.util.*;
import java.util.ArrayList;
public class Hospital {

    private Map<String, Patient> totalPatient;
    private PriorityQueue<Patient> attentionQueue; //gestiona a los pacientes en espera
    private Map<String, AreaAttention> areasAttention;// asignar paciente a areas especificas
    private List<Patient> patientAttended;// pacientes para la casa

    Hospital() {
        this.totalPatient = new HashMap<>();
        this.areasAttention = new HashMap<>();
        this.patientAttended = new ArrayList<>();

        areasAttention.put("SAPU", new AreaAttention("SAPU", 90));
        areasAttention.put("urgencia_adulto", new AreaAttention("urgencia_adulto", 120));
        areasAttention.put("infantil", new AreaAttention("infantil", 100));

        this.attentionQueue = new PriorityQueue<>(new compare());
        /*
        public int compare(Patient p1, Patient p2) {
            if (p1.getCategoria() != p2.getCategoria()) {
                return Integer.compare(p1.getCategoria(), p2.getCategoria());
            }
            return Long.compare(p1.getArrivalTime(), p2.getArrivalTime());
        }
        */
    }

    void registerPatient(Patient patient){
        String id = patient.getID();
        totalPatient.put(id, patient);

        String area = determinarAreaSegunCategoria(patient.getCategoria());
        patient.setArea(area);

        attentionQueue.add(patient);
        // asigna su categoria y su area de atencion?
    }

    private String determinarAreaSegunCategoria(int categoria) {// una forma para asignarle un area en especifica
        if (categoria == 1 || categoria == 2) return "urgencia_adulto";
        else if (categoria == 3 || categoria == 4) return "SAPU";
        else return "infantil";
    }

    void realiseCategory(String ID, int newCategory){
        Patient patient = totalPatient.get(ID);
        patient.setCategory(newCategory);
        patient.recordChange(newCategory);
    }
    public Patient nextpatient(){
        if(attentionQueue.isEmpty()){
            System.out.println("No patients attention available");
            return null;
        }

        Patient patient = attentionQueue.poll();// deberia ya estar ordenado
        int category = patient.getCategoria();
        String areaName = "C" + category;

        AreaAttention area = areasAttention.get(areaName);

        if(area != null){
            area.addPatient(patient);
            System.out.println("Paciente " + patient.getID() + " asignado a área " + areaName);
        }else {
            System.out.println("Área " + areaName + " no encontrada.");
        }

        return null;
    }

    public List<Patient> obtenerPacientesPorCategoria(int categoria){
        List<Patient> pacientesFiltrados = new ArrayList<>();

        for (Patient paciente : attentionQueue) {
            if (paciente.getCategoria() == categoria && paciente.getState().equals("En espera")) {
                pacientesFiltrados.add(paciente);
            }
        }

        return pacientesFiltrados;
    }

    public AreaAttention getArea(String nameArea){
        if (areasAttention.containsKey(nameArea)) {
            return areasAttention.get(nameArea);
        } else {
            System.out.println("Área no encontrada: " + nameArea);
            return null;
        }
    }



}
